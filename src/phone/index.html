<!DOCTYPE HTML>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
        <!--jquery-->
        <script src=jquery/jquery-1.11.3.min.js></script>
        <!-- jquery mobile-->
        <link rel=stylesheet href=jquery-mobile/css/jquery.mobile-1.4.5.css>
            <script src=jquery-mobile/js/jquery.mobile-1.4.5.js></script>
            <!--highcharts-->
            <script src=hightcharts/highcharts.js></script>
            <!-- Scrollz -->
            <link rel=stylesheet href=jquery-scrollz/jquery.scrollz.css>
                <script src=jquery-scrollz/jquery.scrollz.min.js></script>
                <script type="text/javascript">
                    // Next page index loaded
                    var nextPageIndex = 0;
                    
                    // Indicates if new entries loading is in progress
                    var loading = false;
                    
                    // Load more function
                    function loadMore() {
                        
                        if (!loading) {
                            
                            loading = true;
                            protocol = document.location.protocol == 'file:' ? 'http:' : document.location.protocol;
                            url = 'cp42.sinaapp.com';
                            //url = 'http://zippy1978.tumblr.com/rss';
                            $.ajax({
                                   type: "GET",
                                   //url: protocol + '//ajax.googleapis.com/ajax/services/feed/load?v=1.0&num=1000&callback=?&q=' + encodeURIComponent(url),
                                   url: protocol + encodeURIComponent(url),
                                   //dataType: 'json',
                                   dataType: 'text',
                                   error: function(){
                                   loading = false;
                                   },
                                   success: function(xmlbook){
                                   
                                   var targetList = $('#items');
                                   
                                   /*values = xml.responseData.feed.entries;
                                    
                                    // First page
                                    if (nextPageIndex == 0) {
                                    targetList.empty();
                                    }
                                    
                                    $.each(values, function() {
                                    targetList.append('<li><img class="ui-li-icon" src="https://lh5.googleusercontent.com/-T4SN-W1_Gkk/AAAAAAAAAAI/AAAAAAAAAv0/xRQBInxIzJo/s120-c/photo.jpg"/><h3 class="wrapping-new-line"><a href="' + this.link + '">' + this.title + '</a></h3><p class="wrapping-new-line">' + this.contentSnippet + '<a href="' + this.link + '">read more</a></p><p class="date">' + this.publishedDate + '</p></li>');
                                    });
                                    
                                    targetList.listview("refresh");*/
                                   
                                   //var txt = document.getElementById("textscroller").value;
                                   document.getElementById("textscroller").innerHTML = xmlbook;
                                   //if (loading == ture) {
                                   //   list = ['机器人叛乱', '创造力', '从0到1', '失控', '经验的疆界']
                                   //   $('#bookchart').highcharts();
                                   //   }
                                   var i = 0;
                                   
                                   //var pop_book_list = JSON.parse('[{"name": "机器人叛乱", "want": 15}, {"name": "创造力", "want": 13}, {"name":"从0到1", "want": 7}, {"name":"失控", "want": 7}, {"name":"经验的疆界", "want": 3}]');
                                var pop_book_list = JSON.parse(xmlbook);
                                book_list.length = 0;
                                tag_number_list.length = 0;
                                for (i=0; i < pop_book_list.length; i++){
                                    var bookname = pop_book_list[i].name;
                                    if (bookname.length > 5){
                                        cut_bookname = bookname.substr(0,4);
                                        cut_bookname += '...';
                                        book_list.push(cut_bookname);
                                    }else{
                                        book_list.push(bookname);
                                    }                                  
                                    tag_number_list.push(pop_book_list[i].want);
                                }
                                   
                                   //截断书名的代码
                                //   var str="创新算法"
                                 //  var bookcut = str.substr(0,2);
                                 //  book_list.push(bookcut);
                                 //  tag_number_list.push(6);
          
                                   
                                   showBookChart();
                                   
                                   // Hide pull header after first page is loaded
                                   if (nextPageIndex == 0) {
                                   $('#container').scrollz('hidePullHeader');
                                   }
                                   
                                   nextPageIndex++;
                                   loading = false;
                                   }
                                   });
                                   
                        }
                        
                    }
                
                // Load initial items
                loadMore();
                
                $(document).on('pulled', '#container', function() {
                               // Reset page index
                               nextPageIndex = 0;
                               
                               // Reload
                               loadMore();
                               });


                                book_list = ['Books', 'Lover', 'Rebel of Robots', 'Story', 'Element of Styles'];
                                tag_number_list = [3,6,4,7,8];
                                function showBookChart() {
                                   $('#bookchart').highcharts({
                                                              chart: {
                                                              type: 'bar'
                                                              },
                                                              title: {
                                                              text: '本周热点图书'
                                                              },
                                                              subtitle: {
                                                              text: 'in this week'
                                                              },
                                                              xAxis: {
                                                              categories: book_list
                                                              },
                                                              yAxis: {
                                                              min: 0,
                                                              title: {
                                                              text: '标记人数'
                                                              }
                                                              },
                                                              tooltip: {
                                                              valueSuffix: '人'
                                                              },
                                                              plotOptions: {
                                                              series:{
                                                              stacking: 'normal'
                                                              }
                                                              },
                                                              legend: {
                                                              reversed: true
                                                              },
                                                              series: [{
                                                                       name: '已读',
                                                                       data: tag_number_list//[5,3,4,7,2]
                                                                       //}, {
                                                                       //   name: '在读',
                                                                       //   data: [2,2,3,2,1]
                                                                       //}, {
                                                                       //   name: '想读',
                                                                       //   data: [3,4,4,2,5]
                                                                       }]
                                                              });
                }
                
                $(showBookChart);
                
                
                    </script>
                
                <style type="text/css">
                    #textscroller {
                        /*position: absolute; */
                        z-index: 1;
                        top: 400px;
                        bottom: 48px;
                        left: 0;
                        width: 100%;
                        background: #fff;
                        overflow: hidden;
                    }
                
                #bookchart {
                    /*position: absolute; */ /*This code will block pull-to-refresh function*/ 
                    z-index: 1;
                    top: 0px;
                    bottom: 48px;
                    left: 0;
                    width: 100%;
                    height: 800px;
                    background: #fff;
                    overflow: hidden;
                }
                
                p {
                    font-size: 16px;
                    padding: 1.2em;
                    line-height: 200%;
                }
                </style>
    </head>
    
    <body>
        
        <div id="container"  data-role="content" data-scrollz="pull">
            <div id="bookchart"></div>
            <div id="textscroller" >
                <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum. Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
            </div>
            
        </div>
    </body>
</html>
